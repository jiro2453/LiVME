# AdSense デプロイメントチェックリスト

LIVMEアプリケーションのAdSense広告が正しく設定されているか確認するチェックリストです。

---

## ✅ 現在の設定状況

### 完了済み

- ✅ **AdSenseアカウント登録**
  - パブリッシャーID: `ca-pub-9899334610612784`

- ✅ **AdSlotコンポーネント実装**
  - ファイル: `/components/AdSlot.tsx`
  - AdSenseスクリプト動的ロード機能
  - IntersectionObserver対応
  - モーダル表示中の非表示機能

- ✅ **ads.txt配置**
  - ファイル: `/ads.txt`
  - 内容: `google.com, pub-9899334610612784, DIRECT, f08c47fec0942fa0`

- ✅ **アコーディオン内広告の有効化**
  - ファイル: `/App.tsx` (約640行目)
  - `enabled={true}`
  - 広告ユニットID: `5486684481`
  - 配置: 各年の2つ目の月の直後

### 未実装（段階的ロールアウト用）

- ⏳ **プロフィール末尾広告**
  - ファイル: `/components/ProfileModal.tsx` (約1331行目)
  - 現在: `enabled={false}`
  - 推奨: 1週間後に有効化を検討

- ⏳ **検索結果広告**
  - 未実装（将来の拡張）

---

## 🚀 デプロイ前チェックリスト

### 1. コード確認

#### App.tsx
```tsx
// ✅ 以下のように設定されているか確認
<AdSlot
  key={`ad-${year}-${month}`}
  variant="banner"
  enabled={true} // ← true になっているか
  isModalOpen={!!(selectedLive || showAddLive || showProfile || showUserProfile)}
  slotId={`ad-accordion-${year}`}
  adUnitId="5486684481" // ← 広告ユニットIDが設定されているか
/>
```

#### AdSlot.tsx
```tsx
// ✅ パブリッシャーIDが正しいか確認
const ADSENSE_CLIENT_ID = 'ca-pub-9899334610612784';
```

#### ads.txt
```
google.com, pub-9899334610612784, DIRECT, f08c47fec0942fa0
```

### 2. ビルド確認

```bash
# ビルドエラーがないか確認
npm run build

# または
yarn build
```

**確認項目**:
- ✅ エラーなくビルドが完了する
- ✅ 警告がないか確認

### 3. ローカルテスト

```bash
# 開発サーバーを起動
npm run dev

# または
yarn dev
```

**確認項目**:
1. ✅ アプリが正常に起動する
2. ✅ ログインできる
3. ✅ 参加公演リストが表示される
4. ✅ 2つ目の月の後に広告枠（カード）が表示される
5. ✅ 「広告」ラベルが表示される
6. ✅ F12でコンソールを開き、以下のログを確認：
   ```
   ✅ AdSense script loaded successfully
   ✅ AdSense ad initialized for slot: ad-accordion-2025
   ```

---

## 🌐 デプロイ手順

### Netlifyの場合

1. **ads.txtの配置確認**
   - Netlifyでは `/ads.txt` がルートに自動配置される
   - デプロイ後、`https://yourdomain.com/ads.txt` にアクセスして確認

2. **デプロイ**
   ```bash
   git add .
   git commit -m "feat: Enable AdSense ads in accordion"
   git push
   ```

3. **Netlifyでビルド確認**
   - Netlifyダッシュボードでビルドステータスを確認
   - デプロイが成功したか確認

### Vercelの場合

1. **ads.txtの配置確認**
   - Vercelでは `/ads.txt` がルートに自動配置される
   - デプロイ後、`https://yourdomain.com/ads.txt` にアクセスして確認

2. **デプロイ**
   ```bash
   git add .
   git commit -m "feat: Enable AdSense ads in accordion"
   git push
   ```

3. **Vercelでビルド確認**
   - Vercelダッシュボードでビルドステータスを確認
   - デプロイが成功したか確認

---

## 🧪 本番環境テスト

### 1. ads.txtの確認

ブラウザで以下にアクセス：
```
https://yourdomain.com/ads.txt
```

**期待される表示**:
```
google.com, pub-9899334610612784, DIRECT, f08c47fec0942fa0
```

### 2. 広告枠の表示確認

**手順**:
1. 本番サイトにアクセス
2. ログイン
3. 参加公演を複数追加（異なる年月）
4. 2つ目の月の後に広告枠が表示されるか確認

**確認ポイント**:
- ✅ 「広告」ラベルが左上に表示される
- ✅ カード型のデザインでLiveCardと調和している
- ✅ 上下に8pxの余白がある
- ✅ レスポンシブ（横幅100%）

### 3. 開発者ツールで確認

**手順**:
1. F12キーで開発者ツールを開く
2. Consoleタブを選択
3. 以下のログを確認：

**期待されるログ**:
```
✅ AdSense script loaded successfully
✅ AdSense ad initialized for slot: ad-accordion-2025
```

**エラーがある場合**:
```
❌ Failed to load AdSense script
❌ AdSense initialization error: ...
```

### 4. ネットワークタブで確認

**手順**:
1. F12キーで開発者ツールを開く
2. Networkタブを選択
3. ページをリロード
4. フィルターに "adsbygoogle" と入力

**確認項目**:
- ✅ `adsbygoogle.js` が正常に読み込まれている（Status: 200）
- ✅ 広告リクエストが送信されている

---

## 📊 AdSense管理画面での確認

### 1. 広告ユニットの確認

**AdSense管理画面 > 広告 > 広告ユニットごと**

**確認項目**:
- ✅ 広告ユニット「LIVME - アコーディオン内バナー」が存在する
- ✅ 広告スロットID: `5486684481`
- ✅ 広告タイプ: ディスプレイ広告
- ✅ サイズ: レスポンシブ

### 2. サイトの審査状況

**AdSense管理画面 > サイト**

**確認項目**:
- ✅ サイトが「審査中」または「承認済み」
- ⚠️ 「要確認」の場合は問題を修正

**審査中の場合**:
- 数日〜2週間かかる場合がある
- ads.txtが正しく配置されているか確認
- コンテンツポリシーに違反していないか確認

### 3. レポートの確認（24時間後）

**AdSense管理画面 > レポート**

**確認項目**:
- ✅ 広告リクエスト数が増加している
- ✅ インプレッション（表示回数）が記録されている
- ⏳ 収益が発生している（トラフィック次第）

**注意**: 広告が実際に表示されるまで24〜48時間かかる場合があります。

---

## 🐛 トラブルシューティング

### 広告枠は表示されるが、広告コンテンツが表示されない

**原因と対処法**:

1. **AdSenseの審査中**
   - 対処法: 審査完了まで待つ（数日〜2週間）

2. **広告在庫がない**
   - 対処法: 時間帯を変えて再確認

3. **トラフィックが少ない**
   - 対処法: ある程度のトラフィックが必要

4. **広告ブロッカーが有効**
   - 対処法: 広告ブロッカーを無効化して確認

5. **地域やデバイスの問題**
   - 対処法: 異なる地域/デバイスで確認

### コンソールにエラーが表示される

**エラー例と対処法**:

#### `Failed to load AdSense script`
- **原因**: ネットワークエラー、広告ブロッカー
- **対処法**: ネットワーク接続確認、広告ブロッカー無効化

#### `AdSense initialization error: adsbygoogle.push() error: ...`
- **原因**: 広告ユニットIDが間違っている
- **対処法**: `adUnitId="5486684481"` が正しいか確認

#### `ads.txt file not found`
- **原因**: ads.txtが正しく配置されていない
- **対処法**: `https://yourdomain.com/ads.txt` にアクセスして確認

### 広告が表示されたりされなかったりする

**原因**:
- AdSenseの広告配信アルゴリズム
- 広告在庫の変動
- ユーザーの地域やデバイス

**対処法**:
- 正常な動作です
- 24時間程度様子を見る
- AdSense管理画面でインプレッション率を確認

---

## 📈 モニタリング計画

### 1週間後

**確認項目**:
- 広告表示率（インプレッション率）
- クリック率（CTR）
- 離脱率の変化
- 主要操作率（公演追加、プロフィール編集など）

**目標値**:
- 広告表示率: >95%
- 離脱率の増加: <10%
- 主要操作率: 変化なし

### 2週間後

**判断**:
- 問題なければプロフィール末尾広告の有効化を検討
- 離脱率が増加している場合は、広告配置の見直し

**プロフィール末尾広告の有効化**:
1. AdSense管理画面で新しい広告ユニット（ネイティブ広告）を作成
2. `/components/ProfileModal.tsx` の `enabled={false}` を `true` に変更
3. 新しい広告ユニットIDを設定

### 1ヶ月後

**最適化**:
- 広告配置の調整
- 広告フォーマットの最適化
- 収益とUXのバランス確認

---

## 📝 まとめ

**現在の状態**:
- ✅ AdSense統合完了
- ✅ アコーディオン内広告が有効
- ✅ ads.txt配置済み
- ⏳ AdSense審査待ち（場合による）

**次のアクション**:
1. 本番環境にデプロイ
2. ads.txtが正しくアクセスできるか確認
3. 広告枠が表示されるか確認
4. AdSense管理画面でレポートを確認（24時間後）
5. 1週間後にKPIをレビュー

**成功の指標**:
- 広告が正常に表示される
- ユーザー体験が損なわれていない
- 収益が発生し始める

---

**最終更新**: 2025年10月16日  
**ステータス**: デプロイ準備完了 ✅  
**次のマイルストーン**: 本番デプロイ → 1週間モニタリング
